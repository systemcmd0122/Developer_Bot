const { Events, EmbedBuilder } = require('discord.js');
const { GoogleGenerativeAI } = require('@google/generative-ai');
const chalk = require('chalk');

const API_KEY = process.env.GEMINI_API_KEY;
const genAI = new GoogleGenerativeAI(API_KEY);

module.exports = {
    name: Events.MessageCreate,
    async execute(message) {
        // Botã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ç„¡è¦–
        if (message.author.bot) return;

        // "é©æ­£ãƒ©ãƒ³ã‚¯"ã¨ã„ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
        if (message.content !== 'é©æ­£ãƒ©ãƒ³ã‚¯') return;

        try {
            // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°é–‹å§‹
            await message.channel.sendTyping();

            // VALORANTãƒ©ãƒ³ã‚¯ã‚·ã‚¹ãƒ†ãƒ 
            const ranks = [
                'ã‚¢ã‚¤ã‚¢ãƒ³',
                'ãƒ–ãƒ­ãƒ³ã‚º', 
                'ã‚·ãƒ«ãƒãƒ¼',
                'ã‚´ãƒ¼ãƒ«ãƒ‰',
                'ãƒ—ãƒ©ãƒãƒŠ',
                'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰',
                'ã‚¢ã‚»ãƒ³ãƒ€ãƒ³ãƒˆ',
                'ã‚¤ãƒ¢ãƒ¼ã‚¿ãƒ«',
                'ãƒ¬ãƒ‡ã‚£ã‚¢ãƒ³ãƒˆ'
            ];

            // å®Œå…¨ãƒ©ãƒ³ãƒ€ãƒ ã§ãƒ©ãƒ³ã‚¯ã‚’é¸æŠ
            const selectedRank = ranks[Math.floor(Math.random() * ranks.length)];

            // Gemini AIãƒ¢ãƒ‡ãƒ«ã®è¨­å®š
            const model = genAI.getGenerativeModel({ 
                model: "gemini-2.0-flash",
                generationConfig: {
                    temperature: 0.9,
                    topK: 50,
                    topP: 0.95,
                    maxOutputTokens: 200,
                }
            });

            // ãƒ©ãƒ³ã‚¯ã«å¿œã˜ãŸç†ç”±ç”Ÿæˆã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
            const prompt = `ã‚ãªãŸã¯VALORANTã®é¢ç™½ã„ãƒ©ãƒ³ã‚¯åˆ¤å®šã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚
            
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€Œ${message.author.username}ã€ãŒã€Œ${selectedRank}ã€ãƒ©ãƒ³ã‚¯ã«åˆ¤å®šã•ã‚Œã¾ã—ãŸã€‚

ã“ã®ãƒ©ãƒ³ã‚¯ã«åˆ¤å®šã•ã‚ŒãŸç†ç”±ã‚’ã€ä»¥ä¸‹ã®æ¡ä»¶ã§ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š
- 2-3æ–‡ç¨‹åº¦ã®çŸ­ã„æ–‡ç« 
- ãã®ãƒ©ãƒ³ã‚¯ã‚‰ã—ã„ç‰¹å¾´ã‚„èƒ½åŠ›ã«ã¤ã„ã¦è¨€åŠ
- å»ºè¨­çš„ã§å‰å‘ããªå†…å®¹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‹ã‚‰æƒ³åƒã§ãã‚‹è¦ç´ ãŒã‚ã‚Œã°è»½ãç¹”ã‚Šäº¤ãœã‚‹
- æ¯å›ç•°ãªã‚‹ç†ç”±ã«ãªã‚‹ã‚ˆã†å‰µé€ çš„ã«
- ãƒ©ãƒ³ã‚¯åã¯å«ã‚ãªã„ï¼ˆæ—¢ã«è¡¨ç¤ºã•ã‚Œã‚‹ãŸã‚ï¼‰

${selectedRank}ãƒ©ãƒ³ã‚¯ã®ç‰¹å¾´:
- ã‚¢ã‚¤ã‚¢ãƒ³: åˆå¿ƒè€…ã€åŸºæœ¬æ“ä½œç¿’å¾—ä¸­
- ãƒ–ãƒ­ãƒ³ã‚º: åŸºç¤ã¯ç†è§£ã€ã‚¨ã‚¤ãƒ ã¨ãƒã‚¸ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ã«èª²é¡Œ
- ã‚·ãƒ«ãƒãƒ¼: ã‚²ãƒ¼ãƒ åŸºç¤ã¯ç†è§£ã€æˆ¦è¡“çš„æ€è€ƒãŒæœªç†Ÿ
- ã‚´ãƒ¼ãƒ«ãƒ‰: ä¸­ç´šè€…ã€åŸºæœ¬æˆ¦è¡“ã¨ã‚¨ã‚¤ãƒ ãŒå®‰å®š
- ãƒ—ãƒ©ãƒãƒŠ: ä¸Šç´šè€…å…¥ã‚Šå£ã€ãƒãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã¨å€‹äººæŠ€èƒ½å‘ä¸Š
- ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰: é«˜ã‚¹ã‚­ãƒ«ã€æˆ¦ç•¥çš„æ€è€ƒã¨å®Ÿè¡ŒåŠ›
- ã‚¢ã‚»ãƒ³ãƒ€ãƒ³ãƒˆ: éå¸¸ã«é«˜ã‚¹ã‚­ãƒ«ã€ãƒ—ãƒ­ãƒ¬ãƒ™ãƒ«è¿‘ã„
- ã‚¤ãƒ¢ãƒ¼ã‚¿ãƒ«: ã‚¨ãƒªãƒ¼ãƒˆã€ãƒˆãƒƒãƒ—ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã®å·®ã‚ãšã‹
- ãƒ¬ãƒ‡ã‚£ã‚¢ãƒ³ãƒˆ: æœ€é«˜å³°ã€ãƒ—ãƒ­ãƒ¬ãƒ™ãƒ«å®ŸåŠ›

ç†ç”±ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š`;

            // AIç†ç”±ç”Ÿæˆã‚’å®Ÿè¡Œ
            const result = await model.generateContent(prompt);
            const aiReason = result.response.text().trim();

            // ç†ç”±ã®é•·ã•åˆ¶é™ã¨æ¸…æµ„åŒ–
            let finalReason = aiReason;
            if (finalReason.length > 250) {
                finalReason = finalReason.substring(0, 247) + '...';
            }

            // ä¸é©åˆ‡ãªå†…å®¹ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            if (finalReason.length < 10 || finalReason.includes('ç†ç”±:') || finalReason.includes('åˆ¤å®šç†ç”±')) {
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç†ç”±ã‚’ä½¿ç”¨
                const fallbackReasons = {
                    'ã‚¢ã‚¤ã‚¢ãƒ³': 'VALORANTã®ä¸–ç•Œã¸ã®ç¬¬ä¸€æ­©ã‚’è¸ã¿å‡ºã—ãŸã°ã‹ã‚Šã§ã™ã­ã€‚åŸºæœ¬çš„ãªã‚²ãƒ¼ãƒ ãƒ¡ã‚«ãƒ‹ã‚¯ã‚¹ã‚’å­¦ã³ãªãŒã‚‰ã€ç€å®Ÿã«ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚',
                    'ãƒ–ãƒ­ãƒ³ã‚º': 'ã‚²ãƒ¼ãƒ ã®åŸºæœ¬ã¯ç†è§£ã—ã¦ã„ã¾ã™ãŒã€ã‚¨ã‚¤ãƒ ã®å®‰å®šæ€§ã¨ç«‹ã¡å›ã‚Šã«ã¾ã æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚ç¶™ç¶šçš„ãªç·´ç¿’ã§å¿…ãšä¸Šé”ã§ãã‚‹ã§ã—ã‚‡ã†ã€‚',
                    'ã‚·ãƒ«ãƒãƒ¼': 'ã‚²ãƒ¼ãƒ ç†è§£ã¯ååˆ†ã«ã‚ã‚Šã¾ã™ãŒã€ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ãŒã‹ã‹ã‚‹å ´é¢ã§ã®åˆ¤æ–­åŠ›ã‚’ã•ã‚‰ã«å‘ä¸Šã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚çµŒé¨“ã‚’ç©ã‚€ã“ã¨ãŒé‡è¦ã§ã™ã€‚',
                    'ã‚´ãƒ¼ãƒ«ãƒ‰': 'ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸã‚¹ã‚­ãƒ«ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ã‚¨ã‚¤ãƒ ã¨æˆ¦è¡“çš„æ€è€ƒã®ä¸¡æ–¹ãŒä¸­ç´šãƒ¬ãƒ™ãƒ«ã«é”ã—ã¦ãŠã‚Šã€ãƒãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚‚ã—ã£ã‹ã‚Šã§ãã¦ã„ã¾ã™ã€‚',
                    'ãƒ—ãƒ©ãƒãƒŠ': 'ä¸Šç´šè€…ã¨ã—ã¦èªã‚ã‚‰ã‚Œã‚‹ãƒ¬ãƒ™ãƒ«ã«åˆ°é”ã—ã¦ã„ã¾ã™ã€‚é«˜ã„ã‚¹ã‚­ãƒ«ã¨æˆ¦ç•¥çš„æ€è€ƒã‚’ä½µã›æŒã¡ã€ãƒãƒ¼ãƒ ã®ä¸­æ ¸ã¨ã—ã¦æ´»èºã§ãã‚‹å®ŸåŠ›ãŒã‚ã‚Šã¾ã™ã€‚',
                    'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰': 'éå¸¸ã«é«˜ã„ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«ã‚’æŒã£ã¦ã„ã¾ã™ã€‚æˆ¦ç•¥çš„æ€è€ƒã¨å®Ÿè¡ŒåŠ›ãŒå„ªã‚Œã¦ãŠã‚Šã€ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã®ã‹ã‹ã‚‹å ´é¢ã§ã‚‚å†·é™ã«å¯¾å¿œã§ãã‚‹èƒ½åŠ›ãŒã‚ã‚Šã¾ã™ã€‚',
                    'ã‚¢ã‚»ãƒ³ãƒ€ãƒ³ãƒˆ': 'ã‚¨ãƒªãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã®ã‚¹ã‚­ãƒ«ã‚’æŒã¤ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã™ã€‚ãƒ—ãƒ­ãƒ¬ãƒ™ãƒ«ã«è¿‘ã„æŠ€è¡“ã¨æˆ¦è¡“ç†è§£ã‚’ä½µã›æŒã¡ã€ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’åœ§å€’ã™ã‚‹å­˜åœ¨æ„ŸãŒã‚ã‚Šã¾ã™ã€‚',
                    'ã‚¤ãƒ¢ãƒ¼ã‚¿ãƒ«': 'ãƒˆãƒƒãƒ—ã‚¯ãƒ©ã‚¹ã®ã‚¨ãƒªãƒ¼ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã™ã€‚ãƒ—ãƒ­ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã‚‚äº’è§’ã«æ¸¡ã‚Šåˆãˆã‚‹å®ŸåŠ›ã‚’æŒã¡ã€ã‚²ãƒ¼ãƒ ã®å…¨ã¦ã®è¦ç´ ã§æœ€é«˜ãƒ¬ãƒ™ãƒ«ã®èƒ½åŠ›ã‚’ç™ºæ®ã—ã¦ã„ã¾ã™ã€‚',
                    'ãƒ¬ãƒ‡ã‚£ã‚¢ãƒ³ãƒˆ': 'æœ€é«˜å³°ã®å®ŸåŠ›ã‚’æŒã¤ä¼èª¬çš„ãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã™ã€‚VALORANTã«ãŠã‘ã‚‹æœ€é«˜åˆ°é”ç‚¹ã¨ã—ã¦ã€å®Œç’§ã«è¿‘ã„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’ç™ºæ®ã§ãã‚‹èƒ½åŠ›ãŒã‚ã‚Šã¾ã™ã€‚'
                };
                finalReason = fallbackReasons[selectedRank];
            }

            // ãƒ©ãƒ³ã‚¯ã«å¿œã˜ãŸè‰²è¨­å®š
            const rankColors = {
                'ã‚¢ã‚¤ã‚¢ãƒ³': '#6B4E3D',
                'ãƒ–ãƒ­ãƒ³ã‚º': '#CD7F32', 
                'ã‚·ãƒ«ãƒãƒ¼': '#C0C0C0',
                'ã‚´ãƒ¼ãƒ«ãƒ‰': '#FFD700',
                'ãƒ—ãƒ©ãƒãƒŠ': '#00FFFF',
                'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰': '#B9F2FF',
                'ã‚¢ã‚»ãƒ³ãƒ€ãƒ³ãƒˆ': '#00FF41',
                'ã‚¤ãƒ¢ãƒ¼ã‚¿ãƒ«': '#FF4654',
                'ãƒ¬ãƒ‡ã‚£ã‚¢ãƒ³ãƒˆ': '#FFFF9E'
            };

            // ãƒ©ãƒ³ã‚¯ã«å¿œã˜ãŸçµµæ–‡å­—
            const rankEmojis = {
                'ã‚¢ã‚¤ã‚¢ãƒ³': 'âš«',
                'ãƒ–ãƒ­ãƒ³ã‚º': 'ğŸŸ¤',
                'ã‚·ãƒ«ãƒãƒ¼': 'âšª',
                'ã‚´ãƒ¼ãƒ«ãƒ‰': 'ğŸŸ¡',
                'ãƒ—ãƒ©ãƒãƒŠ': 'ğŸ”µ',
                'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰': 'ğŸ’',
                'ã‚¢ã‚»ãƒ³ãƒ€ãƒ³ãƒˆ': 'ğŸŸ¢',
                'ã‚¤ãƒ¢ãƒ¼ã‚¿ãƒ«': 'ğŸ”´',
                'ãƒ¬ãƒ‡ã‚£ã‚¢ãƒ³ãƒˆ': 'ğŸŒŸ'
            };

            // è¿½åŠ ã®ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ãƒ†ã‚­ã‚¹ãƒˆï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰
            const flavorTexts = [
                'é‹å‘½ã®å°ãã«ã‚ˆã‚‹åˆ¤å®šçµæœã§ã™ï¼',
                'æ˜Ÿã€…ã®é…ç½®ãŒç¤ºã™çœŸã®å®ŸåŠ›ï¼',
                 'AIåˆ†æã«ã‚ˆã‚‹æ·±å±¤åˆ¤å®šçµæœï¼',
                'å®‡å®™ã®æ³•å‰‡ãŒå°ã„ãŸãƒ©ãƒ³ã‚¯ã§ã™ï¼',
                'é‡å­ãƒ¬ãƒ™ãƒ«ã®è§£æã«ã‚ˆã‚‹åˆ¤å®šï¼',
                'å¤ä»£ã®å¡æ™ºã¨AIã®èåˆåˆ¤å®šï¼',
                'å¤šæ¬¡å…ƒè§£æã«ã‚ˆã‚‹çœŸå®Ÿã®çµæœï¼',
                'é‹å‘½ã®å¥³ç¥ãŒé¸ã‚“ã ãƒ©ãƒ³ã‚¯ï¼'
            ];
            const randomFlavorText = flavorTexts[Math.floor(Math.random() * flavorTexts.length)];

            // ãƒ©ãƒ³ã‚¯ã«å¿œã˜ãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹
            const adviceMap = {
                'ã‚¢ã‚¤ã‚¢ãƒ³': 'ã‚¨ã‚¤ãƒ ç·´ç¿’ã¨ãƒãƒƒãƒ—å­¦ç¿’ã«é›†ä¸­ã—ã¾ã—ã‚‡ã†ï¼The Rangeã§ã®ç·´ç¿’ãŒãŠã™ã™ã‚ã§ã™ã€‚',
                'ãƒ–ãƒ­ãƒ³ã‚º': 'ãƒ‡ã‚¹ãƒãƒƒãƒã§æ’ƒã¡åˆã„ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã€ãƒãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã‚’æ„è­˜ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚',
                'ã‚·ãƒ«ãƒãƒ¼': 'ãƒã‚¸ã‚·ãƒ§ãƒ‹ãƒ³ã‚°ã¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ„è­˜ã—ã¦ã€æˆ¦è¡“çš„ãªæ€è€ƒã‚’é›ãˆã¾ã—ã‚‡ã†ã€‚',
                'ã‚´ãƒ¼ãƒ«ãƒ‰': 'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å½¹å‰²ã‚’æ·±ãç†è§£ã—ã€ãƒãƒ¼ãƒ æˆ¦ç•¥ã«è²¢çŒ®ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚',
                'ãƒ—ãƒ©ãƒãƒŠ': 'ãƒ¡ã‚¿ã®ç ”ç©¶ã¨ãƒ—ãƒ­ã®è©¦åˆè¦³æˆ¦ã§ã€ã•ã‚‰ãªã‚‹æˆ¦è¡“ç†è§£ã‚’æ·±ã‚ã¾ã—ã‚‡ã†ã€‚',
                'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰': 'å€‹äººæŠ€èƒ½ã‚’ç¶­æŒã—ã¤ã¤ã€IGLã¨ã—ã¦ã®ã‚¹ã‚­ãƒ«ã‚‚ç£¨ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚',
                'ã‚¢ã‚»ãƒ³ãƒ€ãƒ³ãƒˆ': 'ãƒ—ãƒ­ã‚·ãƒ¼ãƒ³ã®æœ€æ–°æˆ¦è¡“ã‚’ç ”ç©¶ã—ã€ãƒãƒ¼ãƒ ãƒ¡ã‚¤ãƒˆã¨ã®é€£æºã‚’æ¥µã‚ã¾ã—ã‚‡ã†ã€‚',
                'ã‚¤ãƒ¢ãƒ¼ã‚¿ãƒ«': 'ã‚‚ã¯ã‚„ãƒ—ãƒ­ãƒ¬ãƒ™ãƒ«ï¼ç¶™ç¶šçš„ãªåŠªåŠ›ã§ãƒ¬ãƒ‡ã‚£ã‚¢ãƒ³ãƒˆã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ã€‚',
                'ãƒ¬ãƒ‡ã‚£ã‚¢ãƒ³ãƒˆ': 'æœ€é«˜å³°ã®å®ŸåŠ›è€…ã¨ã—ã¦ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å…¨ä½“ã‚’ç‰½å¼•ã—ã¦ã„ã£ã¦ãã ã•ã„ï¼'
            };

            // çµ±è¨ˆæƒ…å ±ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆï¼‰
            const rankPercentage = Math.floor(Math.random() * 25 + 3); // 3-27%ã®ç¯„å›²
            const matchCount = Math.floor(Math.random() * 50 + 10); // 10-59è©¦åˆã®ç¯„å›²

            // Embedä½œæˆ
            const embed = new EmbedBuilder()
                .setTitle('ğŸ¯ VALORANT é©æ­£ãƒ©ãƒ³ã‚¯åˆ¤å®š')
                .setDescription(`**${message.author.username}** ã•ã‚“ã®é©æ­£ãƒ©ãƒ³ã‚¯è¨ºæ–­çµæœ\n*${randomFlavorText}*`)
                .addFields(
                    { 
                        name: `${rankEmojis[selectedRank]} é©æ­£ãƒ©ãƒ³ã‚¯`, 
                        value: `**${selectedRank}**`, 
                        inline: true 
                    },
                    { 
                        name: 'ğŸ“Š æ¨å®šåˆ†å¸ƒ', 
                        value: `å…¨ä½“ã®ç´„${rankPercentage}%`, 
                        inline: true 
                    },
                    { 
                        name: 'ğŸ® äºˆæƒ³è©¦åˆæ•°', 
                        value: `ç´„${matchCount}è©¦åˆã§åˆ°é”`, 
                        inline: true 
                    },
                    { 
                        name: 'ğŸ“‹ AIåˆ¤å®šç†ç”±', 
                        value: finalReason, 
                        inline: false 
                    },
                    {
                        name: 'ğŸ’¡ ä¸Šé”ã‚¢ãƒ‰ãƒã‚¤ã‚¹',
                        value: adviceMap[selectedRank],
                        inline: false
                    }
                )
                .setColor(rankColors[selectedRank])
                .setFooter({ 
                    text: 'Powered by Gemini AI + Random Selection â€¢ è¨ºæ–­çµæœã¯å¨¯æ¥½ç›®çš„ã§ã™',
                    iconURL: message.author.displayAvatarURL({ dynamic: true })
                })
                .setTimestamp();

            // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
            await message.reply({ embeds: [embed] });

            console.log(chalk.green(`âœ“ AI Rank Assessment: ${message.author.username} assessed as ${selectedRank} in #${message.channel.name}`));

        } catch (error) {
            console.error(chalk.red('âœ— Error in rank assessment:'), error);
            
            // ã‚¨ãƒ©ãƒ¼æ™‚ã®å®Œå…¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            const fallbackRanks = [
                'ã‚¢ã‚¤ã‚¢ãƒ³', 'ãƒ–ãƒ­ãƒ³ã‚º', 'ã‚·ãƒ«ãƒãƒ¼', 'ã‚´ãƒ¼ãƒ«ãƒ‰', 
                'ãƒ—ãƒ©ãƒãƒŠ', 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰', 'ã‚¢ã‚»ãƒ³ãƒ€ãƒ³ãƒˆ', 'ã‚¤ãƒ¢ãƒ¼ã‚¿ãƒ«', 'ãƒ¬ãƒ‡ã‚£ã‚¢ãƒ³ãƒˆ'
            ];
            const fallbackRank = fallbackRanks[Math.floor(Math.random() * fallbackRanks.length)];
            
            const fallbackReasonMap = {
                'ã‚¢ã‚¤ã‚¢ãƒ³': 'ã‚·ã‚¹ãƒ†ãƒ éšœå®³ã«ã‚ˆã‚Šè©³ç´°ãªåˆ†æã¯ã§ãã¾ã›ã‚“ã§ã—ãŸãŒã€åŸºç¤ã‹ã‚‰ç€å®Ÿã«æˆé•·ã—ã¦ã„ã‘ã‚‹å¯èƒ½æ€§ã‚’æ„Ÿã˜ã¾ã™ã€‚',
                'ãƒ–ãƒ­ãƒ³ã‚º': 'AIåˆ†æã‚·ã‚¹ãƒ†ãƒ ã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸãŒã€ç¶™ç¶šçš„ãªåŠªåŠ›ã§ç¢ºå®Ÿã«ä¸Šé”ã§ãã‚‹ãƒ¬ãƒ™ãƒ«ã ã¨æ¨æ¸¬ã•ã‚Œã¾ã™ã€‚',
                'ã‚·ãƒ«ãƒãƒ¼': 'æŠ€è¡“çš„ãªå•é¡Œã«ã‚ˆã‚Šè©³ç´°åˆ†æã¯ä¸å¯èƒ½ã§ã—ãŸãŒã€ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸã‚¹ã‚­ãƒ«ã‚’æŒã£ã¦ã„ã‚‹ã¨åˆ¤æ–­ã•ã‚Œã¾ã™ã€‚',
                'ã‚´ãƒ¼ãƒ«ãƒ‰': 'ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã®ãŸã‚å®Œå…¨ãªåˆ†æã¯ã§ãã¾ã›ã‚“ã§ã—ãŸãŒã€ä¸­ç´šè€…ã¨ã—ã¦å®‰å®šã—ãŸå®ŸåŠ›ãŒã‚ã‚‹ã¨è¦‹è¾¼ã¾ã‚Œã¾ã™ã€‚',
                'ãƒ—ãƒ©ãƒãƒŠ': 'AIè§£æã«éšœå®³ãŒç™ºç”Ÿã—ã¾ã—ãŸãŒã€ä¸Šç´šè€…ãƒ¬ãƒ™ãƒ«ã®æ½œåœ¨èƒ½åŠ›ã‚’ç§˜ã‚ã¦ã„ã‚‹ã¨æ¨å®šã•ã‚Œã¾ã™ã€‚',
                'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰': 'ã‚·ã‚¹ãƒ†ãƒ éšœå®³ã«ã‚ˆã‚Šè©³ç´°åˆ¤å®šã¯å›°é›£ã§ã—ãŸãŒã€é«˜ã„ã‚¹ã‚­ãƒ«ãƒ¬ãƒ™ãƒ«ã‚’æŒã£ã¦ã„ã‚‹ã¨è©•ä¾¡ã•ã‚Œã¾ã™ã€‚',
                'ã‚¢ã‚»ãƒ³ãƒ€ãƒ³ãƒˆ': 'AIåˆ†æã‚¨ãƒ©ãƒ¼ã®ãŸã‚è©³ç´°ã¯ä¸æ˜ã§ã™ãŒã€ã‚¨ãƒªãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«ã®å®ŸåŠ›ã‚’æŒã£ã¦ã„ã‚‹ã¨æ¨æ¸¬ã•ã‚Œã¾ã™ã€‚',
                'ã‚¤ãƒ¢ãƒ¼ã‚¿ãƒ«': 'ã‚·ã‚¹ãƒ†ãƒ å•é¡Œã«ã‚ˆã‚Šå®Œå…¨åˆ†æã¯ä¸å¯èƒ½ã§ã—ãŸãŒã€ãƒˆãƒƒãƒ—ã‚¯ãƒ©ã‚¹ã®èƒ½åŠ›ãŒã‚ã‚‹ã¨åˆ¤æ–­ã•ã‚Œã¾ã™ã€‚',
                'ãƒ¬ãƒ‡ã‚£ã‚¢ãƒ³ãƒˆ': 'AIè§£æã‚·ã‚¹ãƒ†ãƒ ã«éšœå®³ãŒç™ºç”Ÿã—ã¾ã—ãŸãŒã€æœ€é«˜å³°ã®å®ŸåŠ›ã‚’æŒã£ã¦ã„ã‚‹ã¨æ¨å®šã•ã‚Œã¾ã™ã€‚'
            };

            const rankColors = {
                'ã‚¢ã‚¤ã‚¢ãƒ³': '#6B4E3D', 'ãƒ–ãƒ­ãƒ³ã‚º': '#CD7F32', 'ã‚·ãƒ«ãƒãƒ¼': '#C0C0C0',
                'ã‚´ãƒ¼ãƒ«ãƒ‰': '#FFD700', 'ãƒ—ãƒ©ãƒãƒŠ': '#00FFFF', 'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰': '#B9F2FF',
                'ã‚¢ã‚»ãƒ³ãƒ€ãƒ³ãƒˆ': '#00FF41', 'ã‚¤ãƒ¢ãƒ¼ã‚¿ãƒ«': '#FF4654', 'ãƒ¬ãƒ‡ã‚£ã‚¢ãƒ³ãƒˆ': '#FFFF9E'
            };

            const rankEmojis = {
                'ã‚¢ã‚¤ã‚¢ãƒ³': 'âš«', 'ãƒ–ãƒ­ãƒ³ã‚º': 'ğŸŸ¤', 'ã‚·ãƒ«ãƒãƒ¼': 'âšª', 'ã‚´ãƒ¼ãƒ«ãƒ‰': 'ğŸŸ¡', 'ãƒ—ãƒ©ãƒãƒŠ': 'ğŸ”µ',
                'ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰': 'ğŸ’', 'ã‚¢ã‚»ãƒ³ãƒ€ãƒ³ãƒˆ': 'ğŸŸ¢', 'ã‚¤ãƒ¢ãƒ¼ã‚¿ãƒ«': 'ğŸ”´', 'ãƒ¬ãƒ‡ã‚£ã‚¢ãƒ³ãƒˆ': 'ğŸŒŸ'
            };
            
            const errorEmbed = new EmbedBuilder()
                .setTitle('ğŸ¯ VALORANT é©æ­£ãƒ©ãƒ³ã‚¯åˆ¤å®š')
                .setDescription(`**${message.author.username}** ã•ã‚“ã®é©æ­£ãƒ©ãƒ³ã‚¯è¨ºæ–­çµæœ\n*ã‚·ã‚¹ãƒ†ãƒ å¾©æ—§ä¸­ã®ãŸã‚ç°¡æ˜“åˆ¤å®šã‚’å®Ÿæ–½*`)
                .addFields(
                    { 
                        name: `${rankEmojis[fallbackRank]} é©æ­£ãƒ©ãƒ³ã‚¯`, 
                        value: `**${fallbackRank}**`, 
                        inline: true 
                    },
                    { 
                        name: 'âš ï¸ çŠ¶æ…‹', 
                        value: 'ã‚·ã‚¹ãƒ†ãƒ å¾©æ—§ä¸­', 
                        inline: true 
                    },
                    { 
                        name: 'ğŸ“‹ åˆ¤å®šç†ç”±', 
                        value: fallbackReasonMap[fallbackRank], 
                        inline: false 
                    }
                )
                .setColor(rankColors[fallbackRank])
                .setFooter({ 
                    text: 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ â€¢ å¾Œã§ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„'
                })
                .setTimestamp();

            await message.reply({ embeds: [errorEmbed] });
        }
    },
};
